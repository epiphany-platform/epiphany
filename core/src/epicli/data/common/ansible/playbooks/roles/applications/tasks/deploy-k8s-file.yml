---
- name: Assert input parameters
  assert:
    that:
      - deployment_tmp_dir is defined
      - file_name is defined

- name: "{{ data.name }}: Upload {{ file_name }} file"
  template:
    dest: "{{ deployment_tmp_dir }}/{{ file_name }}"
    src: "{{ app_dir_name }}/{{ file_name }}.j2"
    mode: u=rw,go=  # may contain secrets
  register: upload_template

- name: "{{ data.name }}: Apply {{ file_name }} file"
  command: kubectl apply -f {{ deployment_tmp_dir }}/{{ file_name }}
  when:
    - upload_template.changed
