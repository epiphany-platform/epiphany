---
- name: Check whether to run download script
  stat:
    path: /tmp/epi-download-requirements/download-requirements-done.flag
  register: stat_result

- name: Run download-requirements script, it can take a long time
  shell: /tmp/epi-download-requirements/download-requirements.sh /var/www/html/epirepo
  when: stat_result.stat.exists == False

- name: Create flag file to not re-download requirements next time
  file:
    path: /tmp/epi-download-requirements/download-requirements-done.flag
    state: touch
  when: stat_result.stat.exists == False