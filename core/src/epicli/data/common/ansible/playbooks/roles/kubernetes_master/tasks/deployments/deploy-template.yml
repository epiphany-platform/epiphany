---
- name: Create directory for files
  become: true
  file:
    path: "{{ epiphany_manifests_dir }}"
    state: directory
    owner: root
    group: root
    mode: u=rwx,go=r

- name: Upload {{ file_name }} file
  become: true
  template:
    src: "{{ file_name }}"
    dest: "{{ epiphany_manifests_dir }}/{{ file_name | regex_replace('.j2$') }}"
    owner: "{{ admin_user.name }}"
    group: "{{ admin_user.name }}"
    mode: u=rw,go=r

- name: Apply file
  include_tasks: apply-file.yml
  vars:
    file_path: "{{ epiphany_manifests_dir }}/{{ file_name | regex_replace('.j2$') }}"
