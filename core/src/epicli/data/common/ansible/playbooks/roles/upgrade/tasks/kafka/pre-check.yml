---
  - name: Check for lock file
    stat:
      path: "{{ lock_file }}"
    register: lock_file_status
    changed_when: False

  - name: Create lock file
    file:
      path: "{{ lock_file }}"
      state: touch
    when: lock_file_status.stat.exists == False

  - name: Check current Kafka version
    shell: >-
      set -o pipefail &&
      /opt/kafka/bin/kafka-server-start.sh --version | grep Commit | grep -ioP '^\d.\d+.\d+'
    register: result
    args:
      executable: /bin/bash

  - name: Set variable current_kafka_version
    set_fact:
      current_kafka_version: "{{ result }}"
    changed_when: False