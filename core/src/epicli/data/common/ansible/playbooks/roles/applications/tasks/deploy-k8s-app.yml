---
- name: Assert input parameters
  assert:
    that:
      - deployment_tmp_root_dir is defined
      - app_dir_name is defined

- name: Deploy application (k8s)
  vars:
    deployment_tmp_dir: "{{ deployment_tmp_root_dir }}/{{ app_dir_name }}"
  always:
    - name: "{{ data.name }}: Remove temporary directory"
      file:
        path: "{{ deployment_tmp_dir }}"
        state: absent
  block:
    - name: "{{ data.name }}: Create directory for deployment files"
      file:
        path: "{{ deployment_tmp_dir }}"
        state: directory

    - name: "{{ data.name }}: Deploy K8s files"
      include_tasks: deploy-k8s-file.yml
      loop: "{{ deployment_files }}"
      loop_control:
        loop_var: file_name
