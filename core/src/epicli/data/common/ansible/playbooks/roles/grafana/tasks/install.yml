---

- name: Remove conflicting grafana packages
  package:
    name: grafana-data
    state: absent
  register: _old_grafana_pkgs

- name: Install dependencies for Debian family
  package:
    name: "{{ item }}"
    state: present
  loop:
    - apt-transport-https
    - adduser
    - ca-certificates
    - libfontconfig
    - gnupg2
  when: ansible_os_family == "Debian"

- name: Install Grafana
  package:
    name: "grafana-{{ grafana_version }}"
    state: present