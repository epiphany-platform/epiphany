- name: Create directory for files
  file: 
    path: "{{ configuration_temp_directory }}"
    state: directory
  become_user: "{{ specification.admin_user.name }}"

- name: Upload auth-service yaml
  become: yes
  template:
    dest: "{{ configuration_temp_directory }}/{{ auth_service_name }}-{{ namespace_name }}.yml"
    src: auth-service/auth-service.yml.j2
    owner: "{{ specification.admin_user.name }}"
    group: "{{ specification.admin_user.name }}"
    mode: 0644

- name: Apply Epiphany Auth Service deployment
  shell: kubectl apply --kubeconfig=/home/{{ specification.admin_user.name }}/.kube/config -f {{ configuration_temp_directory }}/{{ auth_service_name }}-{{ namespace_name }}.yml
  become_user: "{{ specification.admin_user.name }}"
