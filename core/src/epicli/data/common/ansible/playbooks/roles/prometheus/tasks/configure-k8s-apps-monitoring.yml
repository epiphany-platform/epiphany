---
- name: apply rolebinding to k8s for prometheus
  shell: "kubectl apply -f {{ role_path }}/files/k8s-rolebinding.yml"
  delegate_to: localhost
  run_once: true

- name: Get kubernetes bearer token for prometheus
  shell: |-
    kubectl get $(kubectl get secrets -n kube-system -o name | grep prometheus) \
      -n kube-system \
      -o jsonpath='{.data.token}'
  register: kube_token
  delegate_to: localhost
  run_once: true

- name: Set bearer token variable
  set_fact:
    bearer_token: "{{ kube_token.stdout }}"
