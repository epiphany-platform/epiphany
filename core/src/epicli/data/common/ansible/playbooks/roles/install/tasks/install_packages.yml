---
# Expects list of package yaml objects from dependencies named packages_list

- name: prepare list for {{ ansible_os_family }}
  set_fact:
    packages_to_install: "{{ packages_list
    | selectattr('os_family', 'in', [ansible_os_family, 'any']) | list  }}"

- name: Install packages
  include_tasks: "install-package.yml"
  vars:
    package_definition: "{{ item }}"
  loop: "{{ packages_to_install }}"