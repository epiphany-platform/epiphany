---

- name: Download container-selinux for docker {{ docker_version }} for 7.5 and older
  include_role:
    name: download
    tasks_from: download_package
  vars:
    package_arg: { id: 'container-selinux', version: '2.74' }
  when: ansible_distribution_version is version('7.5', '<=')

- name: Download container-selinux for docker {{ docker_version }} for RHEL 7.6 and later
  include_role:
    name: download
    tasks_from: download_package
  vars:
    package_arg: { id: 'container-selinux', version: '2.99' }
  when:  ansible_distribution_version is version('7.6', '>=')

- name: Install container-selinux v{{ file.version }} from {{ file.dest_path }}
  yum:
    name: "{{ file.dest_path }}"
    state: present
    update_cache: yes

- name: Download docker-ce v{{ docker_version }}
  include_role:
    name: download
    tasks_from: download_package
  vars:
    package_arg: "{{ dependencies.docker[docker_version].packages | selectattr('id', 'equalto', 'docker-ce') | list | first }}"

- name: Install docker-ce v{{ file.version }} from {{ file.dest_path }}
  yum:
    name: "{{ file.dest_path }}"
    state: present
    update_cache: yes
