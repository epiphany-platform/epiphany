---
- name: Create alerting rule files from template
  template:
    src: "alert.rules.j2"
    dest: "{{ specification.config_directory }}/rules/{{ item.name }}.rules"
    owner: root
    group: prometheus
    mode: 0640
    validate: "/usr/local/bin/promtool check rules %s"
  with_items:
    - "{{ specification.alerts.rules }}"

- name: Configure alertmanager
  template:
    src: "alertmanager.yml.j2"
    dest: "{{ specification.config_directory }}/alertmanager.yml"
    force: true
    owner: root
    group: prometheus
    mode: 0640
  notify:
    - reload prometheus

