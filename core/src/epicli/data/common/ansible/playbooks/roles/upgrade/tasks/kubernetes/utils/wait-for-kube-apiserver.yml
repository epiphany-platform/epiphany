---
- delegate_to: "{{ groups.kubernetes_master[0] }}"
  run_once: true
  environment:
    KUBECONFIG: /home/{{ admin_user.name }}/.kube/config
  block:
    - name: Wait for kubectl to access K8s cluster
      command: >-
        kubectl cluster-info
      register: result
      until:
        - result is succeeded and "running" in result.stdout
      retries: 60 # 1min
      delay: 1
      changed_when: false
