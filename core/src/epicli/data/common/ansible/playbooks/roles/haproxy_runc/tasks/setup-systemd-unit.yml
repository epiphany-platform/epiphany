---
- name: Assert input parameters
  assert:
    that:
      - runc_dir is defined
      - haproxy_service is defined

- name: Discover runc binary
  shell: |
    which runc
  register: shell_which_runc

- name: Set runc and haproxy related facts
  set_fact:
    haproxy_dir: "{{ runc_dir }}/{{ haproxy_service }}"
    runc_binary: "{{ shell_which_runc.stdout.strip() }}"

- name: Render {{ haproxy_service }} service systemd unit
  template:
    dest: /etc/systemd/system/{{ haproxy_service }}.service
    src: haproxy.service.j2
