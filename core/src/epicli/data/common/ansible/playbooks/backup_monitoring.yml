---
# Ansible playbook for backing up monitoring data

- hosts: prometheus[0]
  become: true
  become_method: sudo
  serial: 1
  tasks:
    - import_role:
        name: backup
        tasks_from: monitoring_prometheus_snapshot
    - import_role:
        name: backup
        tasks_from: monitoring_prometheus_etc
  vars_files:
    - roles/prometheus/vars/main.yml

- hosts: grafana[0]
  become: true
  become_method: sudo
  serial: 1
  tasks:
    - import_role:
        name: backup
        tasks_from: monitoring_grafana_data
      vars:
        snapshot_name: "{{ hostvars[groups.prometheus.0].snapshot_name }}"
  vars_files:
    - roles/grafana/vars/main.yml
