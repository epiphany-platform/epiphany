kind: infrastructure/virtual-machine
version: 0.3.0
title: "Virtual Machine Infra"
provider: azure
name: default
specification:
  name: SET_BY_AUTOMATION
  admin_username: SET_BY_AUTOMATION
  admin_password: SET_BY_AUTOMATION 
  public_key: SET_BY_AUTOMATION
  network_interface_name: SET_BY_AUTOMATION
  os_type: linux
  size: Standard_DS1_v2 
  storage_image_reference:
    publisher: Canonical
    offer: UbuntuServer
    sku: 18.04-LTS
    version: "18.04.201810030" # Never put latest on anything! Need to always pin the version number but testing we can get away with it
  storage_os_disk:
    delete_on_termination: false
    managed: false
    caching: ReadWrite
    create_option: FromImage
    disk_size_gb: 30
    managed_disk_type: Premium_LRS
  network_interface:
    enable_accelerated_networking: false
    private_ip:
    public_ip:
      allocation_method: Static
      idle_timeout_in_minutes: 30
      sku: Standard 
  security:
    rules:            
      - name: ssh
        description: Allow SSH
        priority: 102
        direction: Inbound
        access: Allow
        protocol: Tcp
        source_port_range: "*"
        destination_port_range: "22"
        source_address_prefix: "*"
        destination_address_prefix: "*"    
---
kind: infrastructure/virtual-machine
version: 0.3.0
title: "Virtual Machine Infra"
provider: azure
name: load-balancer-machine
specification:
  size: Standard_DS1_v2
security:
  rules:            
    - name: ssh
      description: Allow SSH
      priority: 102
      direction: Inbound
      access: Allow
      protocol: Tcp
      source_port_range: "*"
      destination_port_range: "22"
      source_address_prefix: "*"
      destination_address_prefix: "*"     
---
kind: infrastructure/virtual-machine
version: 0.3.0
title: "Virtual Machine Infra"
provider: azure
name: kubernetes-master-machine
specification:
  size: Standard_DS2_v2  
security:
  rules:            
    - name: ssh
      description: Allow SSH
      priority: 102
      direction: Inbound
      access: Allow
      protocol: Tcp
      source_port_range: "*"
      destination_port_range: "22"
      source_address_prefix: "*"
      destination_address_prefix: "*" 
---
kind: infrastructure/virtual-machine
version: 0.3.0
title: "Virtual Machine Infra"
provider: azure
name: kubernetes-node-machine
specification:
  size: Standard_DS1_v2
security:
  rules:            
    - name: ssh
      description: Allow SSH
      priority: 102
      direction: Inbound
      access: Allow
      protocol: Tcp
      source_port_range: "*"
      destination_port_range: "22"
      source_address_prefix: "*"
      destination_address_prefix: "*" 
---
kind: infrastructure/virtual-machine
version: 0.3.0
title: "Virtual Machine Infra"
provider: azure
name: kafka-machine
specification:
  size: Standard_DS2_v2
security:
  rules:            
    - name: ssh
      description: Allow SSH
      priority: 102
      direction: Inbound
      access: Allow
      protocol: Tcp
      source_port_range: "*"
      destination_port_range: "22"
      source_address_prefix: "*"
      destination_address_prefix: "*" 
---
kind: infrastructure/virtual-machine
version: 0.3.0
title: "Virtual Machine Infra"
provider: azure
name: rabbit-machine
specification:
  size: Standard_DS2_v2
security:
  rules:            
    - name: ssh
      description: Allow SSH
      priority: 102
      direction: Inbound
      access: Allow
      protocol: Tcp
      source_port_range: "*"
      destination_port_range: "22"
      source_address_prefix: "*"
      destination_address_prefix: "*"       
---
kind: infrastructure/virtual-machine
version: 0.3.0
title: "Virtual Machine Infra"
provider: azure
name: monitoring-machine
specification:
  size: Standard_DS1_v2
security:
  rules:            
    - name: ssh
      description: Allow SSH
      priority: 102
      direction: Inbound
      access: Allow
      protocol: Tcp
      source_port_range: "*"
      destination_port_range: "22"
      source_address_prefix: "*"
      destination_address_prefix: "*" 
---
kind: infrastructure/virtual-machine
version: 0.3.0
title: "Virtual Machine Infra"
provider: azure
name: logging-machine
specification:
  size: Standard_DS1_v2
security:
  rules:            
    - name: ssh
      description: Allow SSH
      priority: 102
      direction: Inbound
      access: Allow
      protocol: Tcp
      source_port_range: "*"
      destination_port_range: "22"
      source_address_prefix: "*"
      destination_address_prefix: "*" 
---
kind: infrastructure/virtual-machine
version: 0.3.0
title: "Virtual Machine Infra"
provider: azure
name: postgresql-machine
specification:
  size: Standard_DS1_v2  
security:
  rules:            
    - name: ssh
      description: Allow SSH
      priority: 102
      direction: Inbound
      access: Allow
      protocol: Tcp
      source_port_range: "*"
      destination_port_range: "22"
      source_address_prefix: "*"
      destination_address_prefix: "*" 
